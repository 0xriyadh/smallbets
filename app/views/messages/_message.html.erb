<%# Be sure to check/update messages/_template.html.erb when changing this file %>

<% current_room ||= message.room %>
<% cache [ message, current_room&.id ] do %>
  <%= message_tag message do %>
    <div class="message__day-separator"><%= local_datetime_tag message.created_at, style: :date %></div>

    <figure class="avatar message__avatar">
      <%= avatar_tag message.creator, loading: :lazy %>
    </figure>

    <turbo-frame id="<%= dom_id(message, :edit) %>">
      <div class="message__body">
        <div class="message__body-content">
          <h3 class="message__meta">
            <span class="message__author" title="<%= message.creator.title %>">
              <strong data-reply-target="author"><%= message.creator.name %></strong>
            </span>

            <%= link_to message_timestamp(message, class: "message__timestamp"), room_at_message_path(current_room, message), target: "_top",
                  class: "message__permalink" %>

            <span class="message__room <%= "message__original-room" if current_room != message.room %>">
              <%= link_to room_display_name(message.room, for_user: nil), room_at_message_path(message.room, message), target: "_top", data: { reply_target: "link" } %>
            </span>

            <%= render "messages/actions", message: message, room: current_room, url: room_at_message_url(current_room, message) %>
          </h3>

          <%= render "messages/presentation", message: message %>
          <%= render "messages/threads", message: message if current_room == message.room %>
          <%= render "messages/boosts/boosts", message: message %>
        </div>
      </div>
    </turbo-frame>
  <% end %>
<% end %>
