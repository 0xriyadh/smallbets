<% 
  year, month_num = month.split('-')
  month_name = Date.new(year.to_i, month_num.to_i, 1).strftime("%B %Y") 
  
  # Days are already sorted in the controller
  days_in_month = days
%>

<div id="month-<%= month %>" style="margin-bottom: 2rem;">
  <h2 class="section-heading"><%= month_name %></h2>
  <div class="stats-grid margin-block">
    <% days_in_month.each do |day| %>
      <div class="card grid-card">
        <div class="card-header">
          <h2 class="txt-h3 margin-none"><%= day %></h2>
        </div>
        <div class="card-body compact">
          <div class="overflow-x-auto">
            <table class="table full-width">
              <tbody>
                <% if daily_stats[day].present? %>
                  <% daily_stats[day].each_with_index do |user, index| %>
                    <% is_current = user.id == Current.user&.id %>
                    <tr class="<%= 'current-user' if is_current %>">
                      <td class="txt-right txt-small txt-faded" style="width: 20px;"><%= index + 1 %></td>
                      <td>
                        <div class="flex gap-inline align-center">
                          <%= link_to user_path(user, from: "/stats/daily"), class: "flex align-center hover-target", style: "text-decoration: none; gap: 4px; min-width: 0;" do %>
                            <% if user.avatar.attached? %>
                              <div class="avatar avatar-xs">
                                <%= image_tag user.avatar, alt: user.name, loading: "lazy" %>
                              </div>
                            <% else %>
                              <div class="avatar avatar-xs">
                                <%= user.name.first.upcase %>
                              </div>
                            <% end %>
                            <span class="txt-truncate"><%= user.name %></span>
                          <% end %>
                        </div>
                      </td>
                      <td class="txt-right">
                        <%= number_with_delimiter(user.message_count) %>
                      </td>
                    </tr>
                  <% end %>
                <% else %>
                  <tr>
                    <td colspan="3" class="txt-center">No messages yet</td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div> 